
    {% extends "base.html" %}
    {% block content %}
    <div class="container">
        <div align="center"><font size="12" color="f46430">Tinville</font></div>

        <div class="container">
        <!-- load items dynamically -->
        <div align="center" id="checkoutcartitems" class="col-xs-12 col-md-10 col-lg-10 col-xl-10"></div>
        </div>
    </div>
        <!-- align right -->
        <div class="container" align="center">
            <div>
                <div>
                    <div id="checkoutTotal">Total: </div>
                </div>
                <div style="position:relative; left: 100px;">
                    <!-- paypal button -->
                    <button id="paypalBtn">PayPal Button</button>
                </div>
            </div>
        </div>

<script>
    $(function() {
        LoadCheckoutCartDivs();
        aggregateCheckoutTotal();
    });

function LoadCheckoutCartDivs()
{
    var url = "/load_cart"
    ajax_req = $.ajax({
        url: url,
        type: "GET",
        dataType: 'json',
        success: function(data, textStatus, jqXHR) {
            $.each(data, function(index, item)
            {
                if (item.msg == ''){
                    item.image = "{{ MEDIA_URL }}" + item.image
                    LoadCheckoutCartDiv(item)
                }
                else {
                    $('#messageId').html(item.msg)
                    $('#messageModal').modal('show');
                }
            });
        },
        error: function(data, textStatus, jqXHR) {
        }
    });
}

    function LoadCheckoutCartDiv(cartItem)
    {
        var cartitemdiv =  $('<div/>', {
            'class':'shoppingcartitem col-xs-12 col-sm-12 col-md-12',
            'id' : cartItem.Id
        });

        var itemThumbnail = $('<img/>', {'src':cartItem.image, 'class': 'img-responsive shoppingcartthumbnail'});
        var thumbnailDiv = $('<div/>', {'class': 'shoppingcartthumbnaildiv'});
        itemThumbnail.appendTo(thumbnailDiv);
        thumbnailDiv.appendTo(cartitemdiv);

        var itemInfoDiv = $('<div/>', {'class' : 'shoppingcartiteminfo'});

        var itemTitle = $('<div/>', {'class':'shoppingcartitemTitle','text':cartItem.title});
        itemTitle.appendTo(itemInfoDiv);

        var itemDescription = $('<div/>', {'class':'shoppingcartitemDescription', 'text':cartItem.description});
        itemDescription.appendTo(itemInfoDiv);

        itemInfoDiv.appendTo(cartitemdiv);
        var removeBtnDiv = $('<div/>', {'class':'shoppingcartremovebtn'});
        var delBtnId = 'deleteBtnId_' + cartItem.Id;

        var removeBtn = $('<button/>', { 'type' : 'button', 'onclick' : 'RemoveCheckoutItem(' + cartItem.Id + ')', 'id' : delBtnId,
            'class' : 'shoppingcartBtn', 'html' : '<img src="{{ STATIC_URL }}img/delete.png" width="20" height="20">'
        });
        removeBtn.appendTo(removeBtnDiv);
        removeBtnDiv.appendTo(cartitemdiv);

        var qtyDiv = $('<form/>', {'class' : ''});
        var qtyInputDiv = $('<input/>', {'type' : 'number', 'width':40,'min':'1', 'max': cartItem.currentStock, 'value' : cartItem.qty, 'onchange' : 'AddCheckoutItemQuantity(this, ' + cartItem.product_id + ')'});
        qtyInputDiv.appendTo(qtyDiv);
        qtyDiv.appendTo(cartitemdiv);

        var price = '$' + cartItem.price;
        var priceDiv = $('<div/>', {'id': 'id_price_' + cartItem.product_id,'class':'shoppingcartitemPrice', 'text': price});
        priceDiv.appendTo(cartitemdiv);
        cartitemdiv.appendTo("#checkoutcartitems");

    }

    function RemoveCheckoutItem(Id)
    {
        RemoveCartItem(Id);
        $('#'+Id).remove();
        aggregateCheckoutTotal();
    }

    function AddCheckoutItemQuantity(event, id)
    {
        var url = "/update_cart_item"
        ajax_req = $.ajax({
            url: url,
            type: "POST",
            data: {
                "product_id" : id,
                "quantity" : event.value
            },
            success: function(data, textStatus, jqXHR) {
                $('#id_price_'+id).text('$'+data.price);
                $('#checkoutTotal').text('Total: $' + data.total);
            },
            error: function(data, textStatus, jqXHR) {
            }
        });

        //aggregateCheckoutTotal();
    }

    function aggregateCheckoutTotal()
    {
        var url = "/cart_total"
        ajax_req = $.ajax({
            url: url,
            type: "GET",
            success: function(data, textStatus, jqXHR) {
                $('#checkoutTotal').text('Total: $' + data.total);
            },
            error: function(data, textStatus, jqXHR) {
            }
        });
    }


</script>
    {% endblock %}