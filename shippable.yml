language: python

python:
  - 2.7
addons:
  firefox: "27.0"

env:
  global:
    - DISPLAY=:99.0

    - secure: dSyYFP8dYD3MS1FnsA37jVJEUZGM39X5ugT342ofrM9+/RHmRRiMRxzxRITvQrKWpXn0ZYArRwnRidloUQirGKb8YYlabPtUVxwnG7TAG5eLvbmama/C/ikd3OLoHOtYq/qX4GQpEww593CZCpJGeZEkhe9jLRxRGLbJLtfqzK72PieXlMVYq+LrT82fvcWMWq24jkmRkVYfjKgbSGQIFF44K3HSnrjkMBwyS3cVXWkKHrjgi2G1sM0IpsVpg07gIkQAbRlwZWVoAsZh7hSpsT9GcQ9Ns7MTBkl9L34i7L447PKsNWt2dr4wZXxMsIj2cKOXCL0+sr7VMOxpM2upFrLbiYZoIk5ONvpnS/aLIZoBXHISWgQjfIQCEhZ7CI1UMqMOoH0AOKHFpfMW21qCe7fyCIMoIRPeTNIw9EN4UK1DWiIL/OmDdWACnKosBnVVF52xv6YJcNMsaqrUPKae2SHs4CwQcbSzUWa2F+RW8wAFmJIN+y4auJuCzf467CajT8YxfP9tuGqjeqmx/gj9stT4ShiThtFgpd9B+a0ZVeG5n0O7ZnbHCrBHLvkBCHZtTADQjne0IRf05//4RU1Fd0aBV0sZoLzQBiN4QHllRlNDYL/qXqTvDtU5BA3jCrOnbkW+woiXmIVMiStFT6ZejLAcaPOmPprC2C0aDR4uFCo=

install:
  - pip install -r requirements.txt

before_script:
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
#  - mysql -e 'create database test;'
  - /etc/init.d/xvfb start

script:
  - ./test reset_db --noinput
  - ./initDataNoInput test
  - coverage run --source='Tinville,basket,common,designer_shop,extensions,custom_oscar.apps.catalogue,custom_oscar.apps.checkout,custom_oscar.apps.customer,custom_oscar.apps.order,custom_oscar.apps.dashboard,user' manage.py harvest --with-xunit --xunit-file=shippable/testresults/lettucetests.xml --settings=Tinville.settings.test
  - coverage xml -o shippable/codecoverage/coverage_lettuce.xml
  - coverage run --source='Tinville,basket,common,designer_shop,extensions,custom_oscar.apps.catalogue,custom_oscar.apps.checkout,custom_oscar.apps.customer,custom_oscar.apps.order,custom_oscar.apps.dashboard,user' manage.py test --with-xunit --xunit-file=shippable/testresults/unittests.xml --settings=Tinville.settings.test
  - coverage xml -o shippable/codecoverage/coverage_unittests.xml

after_script:
  - /etc/init.d/xvfb stop

after_success :
  - echo $BRANCH
  - ./deploy.sh