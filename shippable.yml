language: python

python:
  - 2.7
addons:
  firefox: "28.0"
services:
  - selenium

env:
  global:
    - DISPLAY=:99.0

install:
  - pip install -r requirements.txt

before_script:
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
#  - mysql -e 'create database test;'
  - /etc/init.d/xvfb start

script:
  - ./test reset_db
  - ./initDataNoInput test
  - coverage run manage.py harvest --with-xunit --xunit-file=shippable/testresults/lettucetests.xml --settings=Tinville.settings.test
  - coverage xml -o shippable/codecoverage/coverage_lettuce.xml
  - coverage run manage.py test --with-xunit --xunit-file=shippable/testresults/unittests.xml --settings=Tinville.settings.test
  - coverage xml -o shippable/codecoverage/coverage_unittests.xml

after_script:
  - /etc/init.d/xvfb stop
